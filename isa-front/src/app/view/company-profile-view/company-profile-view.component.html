<div fxLayout="row" fxLayoutGap="20px">
    <!-- Company info section -->
    <div fxFlex="33">
        <div *ngIf="companyForm&&user">
            <form [formGroup]="companyForm" (ngSubmit)="onSubmit()">
                <div *ngFor="let controlName of ['name', 'description', 'averageRating']">
                    <mat-form-field appearance="fill">
                        <mat-label>{{ controlName }}</mat-label>
                        <input matInput [formControlName]="controlName"
                            [readonly]="!editMode || isRatingField(controlName)" placeholder="rating">
                    </mat-form-field>
                </div>
                <div formArrayName="equipment">
                    <div *ngFor="let equipment of companyForm.get('equipment').value; let i = index">
                        <mat-form-field appearance="fill">
                            <mat-label>Equipment {{ i + 1 }}</mat-label>
                            <input matInput [value]="equipment.name" readonly="" placeholder="equipment">
                        </mat-form-field>
                        <button mat-icon-button color="warn" (click)="removeEquipment(i)" *ngIf="editMode"
                            type="button">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </div>
                <button mat-raised-button color="primary" type="submit" [disabled]="companyForm.invalid"
                    *ngIf="editMode">Save</button>
                <button mat-raised-button color="warn" type="button" (click)="toggleEditMode()"
                    *ngIf="!editMode">Edit</button>
                <button mat-raised-button color="warn" type="button" (click)="toggleEditMode()"
                    *ngIf="editMode">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Address section -->
    <div fxFlex="33">
        <h2>Address</h2>
        <div *ngIf="companyForm&&user">
            <form [formGroup]="companyForm" (ngSubmit)="onSubmit()">
                <div formGroupName="address">
                    <div *ngFor="let controlName of ['street', 'city', 'country', 'zipCode']">
                        <mat-form-field appearance="fill">
                            <mat-label>{{ controlName }}</mat-label>
                            <input matInput [formControlName]="controlName" [readonly]="!editMode"
                                placeholder="zipCode">
                            <mat-error *ngIf="companyForm.get('address').get(controlName).hasError('required')">
                                {{ controlName }} is required.
                            </mat-error>
                            <mat-error *ngIf="companyForm.get('address').get(controlName).hasError('pattern')">
                                {{ controlName }} must be exactly 5 digits.
                            </mat-error>
                        </mat-form-field>
                    </div>
                </div>
            </form>
        </div>
        <app-map [address]="company.address" *ngIf="company?.address"></app-map>
    </div>

    <!-- Admins section -->
    <div fxFlex="33" *ngIf="company?.admins">
        <h2>Company Admins</h2>
        <div *ngFor="let admin of this.company.admins; let i = index">
            <mat-card class="admin-card">
                <mat-card-title>{{admin.firstName + ' ' + admin.lastName}}</mat-card-title>
            </mat-card>
        </div>
    </div>

    <!-- Appointment section -->
    <div *ngIf="company?.admins">
        <h2>Appointments section</h2>
        <button mat-flat-button (click)="addAppointment()" [disabled]="!appointmentForm.valid">Add appointment</button>
        <form [formGroup]="appointmentForm">
            <mat-form-field>
                <mat-label>Administrator</mat-label>
                <mat-select placeholder="select administrator" class="administrator-selector" formControlName="admin">
                    <mat-option *ngFor="let administrator of company.admins"
                        [value]="administrator">{{administrator.firstName}} {{administrator.lastName}}</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field>
                <mat-label>Date</mat-label>
                <input matInput [matDatepicker]="start" formControlName="dateTime" [matDatepickerFilter]="dateFilter">
                <mat-datepicker-toggle matIconSuffix [for]="start"></mat-datepicker-toggle>
                <mat-datepicker #start>
                    <mat-datepicker-actions>
                        <button mat-button matDatepickerCancel>Cancel</button>
                        <button mat-raised-button color="primary" matDatepickerApply>Apply</button>
                    </mat-datepicker-actions>
                </mat-datepicker>
                <mat-hint>MM/DD/YYYY</mat-hint>
            </mat-form-field>
            <mat-form-field>
                <mat-label>Time</mat-label>
                <input matInput type="time" formControlName="time">
                <mat-hint *ngIf="appointmentForm.get('time').errors?.['timeOutsideWorkingHours']">
                    Time must be within the company's working hours ({{workingHours}}).
                </mat-hint>
            </mat-form-field>
            <mat-form-field>
                <mat-label>Duration (minutes)</mat-label>
                <input matInput type="number" formControlName="duration">
                <mat-error *ngIf="appointmentForm.get('duration').errors?.['required']">
                    Duration is required.
                </mat-error>
            </mat-form-field>
        </form>
    </div>
</div>
<p-toast [position]="'bottom-center'"></p-toast>